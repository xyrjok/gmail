<div _ngcontent-ng-c1008791615="" inline-copy-host="" class="markdown markdown-main-panel tutor-markdown-rendering enable-updated-hr-color" id="model-response-message-contentr_43c010b60fccc7ab" aria-live="off" aria-busy="false" dir="ltr" style="--animation-duration: 400ms; --fade-animation-function: linear;"><h1 data-path-to-node="3">Gmail Manager (Cloudflare Edition)</h1><p data-path-to-node="4">这是一个基于 Cloudflare 生态系统（Pages, Workers, D1）构建的轻量级、无服务器 Gmail 管理系统。它允许你管理多个 Gmail 账号、发送循环定时邮件、收取邮件，并提供公开的只读邮件查询链接。</p><h2 data-path-to-node="5">✨ 功能特性</h2><ul data-path-to-node="6"><li><p data-path-to-node="6,0,0"><b>完全无服务器架构</b>：前端托管于 Cloudflare Pages，后端运行在 Cloudflare Workers，数据库使用 D1。</p></li><li><p data-path-to-node="6,1,0"><b>多账号管理</b>：支持添加多个 Gmail 账号（支持 Gmail API 和 GAS 两种模式）。</p></li><li><p data-path-to-node="6,2,0"><b>邮件发送任务</b>：</p><ul data-path-to-node="6,2,1"><li><p data-path-to-node="6,2,1,0,0">支持立即发送和定时发送。</p></li><li><p data-path-to-node="6,2,1,1,0"><b>循环任务</b>：支持设置随机延迟（天/时/分/秒）进行循环发送。</p></li><li><p data-path-to-node="6,2,1,2,0">支持 HTML 内容和纯文本。</p></li></ul></li><li><p data-path-to-node="6,3,0"><b>邮件收取</b>：</p><ul data-path-to-node="6,3,1"><li><p data-path-to-node="6,3,1,0,0">通过 API 或 GAS 收取最新邮件。</p></li><li><p data-path-to-node="6,3,1,1,0">支持自定义收取数量。</p></li></ul></li><li><p data-path-to-node="6,4,0"><b>🛡️ 收件规则 (新功能)</b>：</p><ul data-path-to-node="6,4,1"><li><p data-path-to-node="6,4,1,0,0">创建<b>公开访问链接</b>（如 <code>https://your-worker.com/查询码</code>）。</p></li><li><p data-path-to-node="6,4,1,1,0">访客无需登录即可查看符合规则（发件人/收件人/关键字）的邮件。</p></li><li><p data-path-to-node="6,4,1,2,0">内容自动转换为纯文本，保护隐私。</p></li><li><p data-path-to-node="6,4,1,3,0">支持设置有效期和抓取数量限制。</p></li></ul></li><li><p data-path-to-node="6,5,0"><b>数据管理</b>：支持批量导入/导出账号和规则，批量删除任务。</p></li></ul><h2 data-path-to-node="7">📂 项目结构</h2><response-element class="" ng-version="0.0.0-PLACEHOLDER"><!----><!----><!----><!----><code-block _nghost-ng-c3434968043="" class="ng-tns-c3434968043-961 ng-star-inserted" style=""><!----><!----><div _ngcontent-ng-c3434968043="" class="code-block ng-tns-c3434968043-961 ng-animate-disabled ng-trigger ng-trigger-codeBlockRevealAnimation" jslog="223238;track:impression,attention;BardVeMetadataKey:[[&quot;r_43c010b60fccc7ab&quot;,&quot;c_005150944205f77a&quot;,null,&quot;rc_f822c7b368a24114&quot;,null,null,&quot;zh&quot;,null,1,null,null,1,0]]" data-hveid="0" decode-data-ved="1" data-ved="0CAAQhtANahgKEwjg1Zyanb2RAxUAAAAAHQAAAAAQhgg" style="display: block;"><div _ngcontent-ng-c3434968043="" class="code-block-decoration header-formatted gds-title-s ng-tns-c3434968043-961 ng-star-inserted" style=""><span _ngcontent-ng-c3434968043="" class="ng-tns-c3434968043-961">Plaintext</span><div _ngcontent-ng-c3434968043="" class="buttons ng-tns-c3434968043-961 ng-star-inserted"><button _ngcontent-ng-c3434968043="" aria-label="Copy code" mat-icon-button="" mattooltip="Copy code" class="mdc-icon-button mat-mdc-icon-button mat-mdc-button-base mat-mdc-tooltip-trigger copy-button ng-tns-c3434968043-961 mat-unthemed ng-star-inserted" mat-ripple-loader-uninitialized="" mat-ripple-loader-class-name="mat-mdc-button-ripple" mat-ripple-loader-centered="" jslog="179062;track:generic_click,impression;BardVeMetadataKey:[[&quot;r_43c010b60fccc7ab&quot;,&quot;c_005150944205f77a&quot;,null,&quot;rc_f822c7b368a24114&quot;,null,null,&quot;zh&quot;,null,1,null,null,1,0]];mutable:true"><span class="mat-mdc-button-persistent-ripple mdc-icon-button__ripple"></span><mat-icon _ngcontent-ng-c3434968043="" role="img" fonticon="content_copy" class="mat-icon notranslate gds-icon-s google-symbols mat-ligature-font mat-icon-no-color" aria-hidden="true" data-mat-icon-type="font" data-mat-icon-name="content_copy"></mat-icon><span class="mat-focus-indicator"></span><span class="mat-mdc-button-touch-target"></span></button><!----><!----></div><!----></div><!----><div _ngcontent-ng-c3434968043="" class="formatted-code-block-internal-container ng-tns-c3434968043-961"><div _ngcontent-ng-c3434968043="" class="animated-opacity ng-tns-c3434968043-961"><pre _ngcontent-ng-c3434968043="" class="ng-tns-c3434968043-961"><code _ngcontent-ng-c3434968043="" role="text" data-test-id="code-content" class="code-container formatted ng-tns-c3434968043-961">├── admin/              # 前端管理面板文件
│   ├── index.html      # 主界面
│   ├── script.js       # 前端逻辑
│   └── style.css       # 样式表
├── worker.js           # 后端核心逻辑 (Cloudflare Worker)
├── schema.sql          # 数据库结构 (Cloudflare D1)
└── README.md           # 说明文档
</code></pre><!----></div></div></div><!----><!----></code-block><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></response-element><h2 data-path-to-node="9">🚀 部署指南</h2><p data-path-to-node="10">无需服务器，只需要一个 Cloudflare 账号和 GitHub 账号。</p><h3 data-path-to-node="11">第一步：创建 D1 数据库</h3><ol start="1" data-path-to-node="12"><li><p data-path-to-node="12,0,0">登录 <response-element class="" ng-version="0.0.0-PLACEHOLDER"><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><link-block _nghost-ng-c931907453="" class="ng-star-inserted"><!----><!----><a _ngcontent-ng-c931907453="" target="_blank" rel="noopener" externallink="" _nghost-ng-c3057824812="" jslog="197247;track:generic_click,impression,attention;BardVeMetadataKey:[[&quot;r_43c010b60fccc7ab&quot;,&quot;c_005150944205f77a&quot;,null,&quot;rc_f822c7b368a24114&quot;,null,null,&quot;zh&quot;,null,1,null,null,1,0]]" href="https://dash.cloudflare.com/" class="ng-star-inserted" data-hveid="0" decode-data-ved="1" data-ved="0CAAQ_4QMahgKEwjg1Zyanb2RAxUAAAAAHQAAAAAQhwg">Cloudflare Dashboard</a><!----></link-block><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----></response-element>。</p></li><li><p data-path-to-node="12,1,0">进入 <b>Workers &amp; Pages</b> -&gt; <b>D1 SQL Database</b>。</p></li><li><p data-path-to-node="12,2,0">点击 <b>Create</b>，创建一个新数据库，命名为 <code>gmail_db</code> (或你喜欢的名字)。</p></li><li><p data-path-to-node="12,3,0">进入数据库详情页，点击 <b>Console</b> (控制台) 标签。</p></li><li><p data-path-to-node="12,4,0">复制 <code>schema.sql</code> 文件中的<b>所有代码</b>，粘贴到控制台并点击 <b>Execute</b> 执行。这会创建所需的 4 张表 (<code>accounts</code>, <code>send_tasks</code>, <code>received_emails</code>, <code>account_auth</code>, <code>access_rules</code>)。</p></li></ol><h3 data-path-to-node="13">第二步：部署后端 (Worker)</h3><ol start="1" data-path-to-node="14"><li><p data-path-to-node="14,0,0">进入 <b>Workers &amp; Pages</b> -&gt; <b>Overview</b> -&gt; <b>Create Application</b> -&gt; <b>Create Worker</b>。</p></li><li><p data-path-to-node="14,1,0">命名你的 Worker（例如 <code>gmail-backend</code>），点击 <b>Deploy</b>。</p></li><li><p data-path-to-node="14,2,0">点击 <b>Edit code</b>，将仓库中的 <code>worker.js</code> <b>完整代码</b>复制并覆盖编辑器中的内容。</p></li><li><p data-path-to-node="14,3,0"><b>保存并部署 (Save and Deploy)</b>。</p></li><li><p data-path-to-node="14,4,0">返回 Worker 的设置页面 (<b>Settings</b>):</p><ul data-path-to-node="14,4,1"><li><p data-path-to-node="14,4,1,0,0"><b>Variables (变量)</b>: 添加以下环境变量（加密存储）：</p><ul data-path-to-node="14,4,1,0,1"><li><p data-path-to-node="14,4,1,0,1,0,0"><code>ADMIN_USERNAME</code>: 设置你的后台登录用户名。</p></li><li><p data-path-to-node="14,4,1,0,1,1,0"><code>ADMIN_PASSWORD</code>: 设置你的后台登录密码。</p></li></ul></li><li><p data-path-to-node="14,4,1,1,0"><b>D1 Database Bindings (D1 数据库绑定)</b>:</p><ul data-path-to-node="14,4,1,1,1"><li><p data-path-to-node="14,4,1,1,1,0,0">Variable name (变量名): 填写 <code>DB</code> (必须是大写，与代码一致)。</p></li><li><p data-path-to-node="14,4,1,1,1,1,0">D1 Database: 选择第一步创建的 <code>gmail_db</code>。</p></li></ul></li></ul></li><li><p data-path-to-node="14,5,0">再次点击 <b>Deploy</b> 确保配置生效。</p></li><li><p data-path-to-node="14,6,0"><b>记录 URL</b>: 在 Worker 概览页，找到你的 Worker 域名 (例如 <code>https://gmail-backend.你的用户名.workers.dev</code>)，记下来。</p></li></ol><h3 data-path-to-node="15">第三步：部署前端 (Pages)</h3><ol start="1" data-path-to-node="16"><li><p data-path-to-node="16,0,0">修改 <code>admin/script.js</code>:</p><ul data-path-to-node="16,0,1"><li><p data-path-to-node="16,0,1,0,0">打开 <code>admin/script.js</code> 文件。</p></li><li><p data-path-to-node="16,0,1,1,0">找到第一行 <code>const API_BASE = "https://gm.xyrj.dpdns.org";</code>。</p></li><li><p data-path-to-node="16,0,1,2,0">将其修改为你 <b>第二步中获得的 Worker 域名</b> (注意不要带末尾的斜杠 /)，或者如果你配置了自定义域名路由，可以留空。</p></li><li><p data-path-to-node="16,0,1,3,0"><i>示例</i>: <code>const API_BASE = "https://gmail-backend.user.workers.dev";</code></p></li></ul></li><li><p data-path-to-node="16,1,0">将修改后的代码推送到 GitHub 仓库。</p></li><li><p data-path-to-node="16,2,0">回到 Cloudflare Dashboard，进入 <b>Workers &amp; Pages</b> -&gt; <b>Create Application</b> -&gt; <b>Pages</b> -&gt; <b>Connect to Git</b>。</p></li><li><p data-path-to-node="16,3,0">选择你的 GitHub 仓库。</p></li><li><p data-path-to-node="16,4,0"><b>Build settings (构建设置)</b>:</p><ul data-path-to-node="16,4,1"><li><p data-path-to-node="16,4,1,0,0"><b>Build command</b>: (留空)</p></li><li><p data-path-to-node="16,4,1,1,0"><b>Build output directory</b>: <code>admin</code> (这里填 admin，因为 index.html 在 admin 目录下)。</p></li></ul></li><li><p data-path-to-node="16,5,0">点击 <b>Save and Deploy</b>。</p></li><li><p data-path-to-node="16,6,0">部署完成后，你会获得一个 Pages 域名 (例如 <code>https://gmail-manager.pages.dev</code>)。</p></li></ol><h2 data-path-to-node="17">📖 使用说明</h2><h3 data-path-to-node="18">1. 登录后台</h3><p data-path-to-node="19">访问你的 Pages 域名，输入在 Worker 变量中设置的 <code>ADMIN_USERNAME</code> 和 <code>ADMIN_PASSWORD</code>。</p><h3 data-path-to-node="20">2. 配置 Gmail 账号 (两种模式)</h3><ul data-path-to-node="21"><li><p data-path-to-node="21,0,0"><b>API 模式 (推荐，稳定)</b>:</p><ol start="1" data-path-to-node="21,0,1"><li><p data-path-to-node="21,0,1,0,0">在 Google Cloud Console 创建项目，启用 Gmail API。</p></li><li><p data-path-to-node="21,0,1,1,0">创建 OAuth 凭据，获取 <code>Client ID</code> 和 <code>Client Secret</code>。</p></li><li><p data-path-to-node="21,0,1,2,0">获取 <code>Refresh Token</code> (可以使用 Google 的 OAuth 2.0 Playground)。</p></li><li><p data-path-to-node="21,0,1,3,0">在后台“添加邮箱”，填写以上三项（逗号分隔）。</p></li></ol></li><li><p data-path-to-node="21,1,0"><b>GAS 模式 (备用)</b>:</p><ol start="1" data-path-to-node="21,1,1"><li><p data-path-to-node="21,1,1,0,0">创建一个 Google Apps Script 项目。</p></li><li><p data-path-to-node="21,1,1,1,0">部署为 Web App (权限设置为 "Anyone")。</p></li><li><p data-path-to-node="21,1,1,2,0">在后台“添加邮箱”，填写 GAS 的 Web App URL。</p></li></ol></li></ul><h3 data-path-to-node="22">3. 创建收件规则 (公开链接)</h3><ul data-path-to-node="23"><li><p data-path-to-node="23,0,0">在后台左侧点击“收件规则”。</p></li><li><p data-path-to-node="23,1,0">点击“添加规则”。</p></li><li><p data-path-to-node="23,2,0"><b>查询码</b>: 这是公开访问的凭证。例如设置为 <code>ABC12345</code>。</p></li><li><p data-path-to-node="23,3,0"><b>匹配条件</b>: 设置只显示来自特定发件人或包含特定关键字的邮件。</p></li><li><p data-path-to-node="23,4,0"><b>访问</b>: 只要访问 <code>https://你的Worker域名/ABC12345</code>，即可看到过滤后的邮件纯文本内容。</p></li></ul><h3 data-path-to-node="24">4. 常见问题</h3><ul data-path-to-node="25"><li><p data-path-to-node="25,0,0"><b>页面显示 <code>${content}</code></b>?</p><ul data-path-to-node="25,0,1"><li><p data-path-to-node="25,0,1,0,0">请确保 <code>worker.js</code> 更新到了最新版本，并且你已经点击了“Deploy”重新部署了 Worker。浏览器缓存也可能导致此问题，尝试强制刷新 (Ctrl+F5)。</p></li></ul></li><li><p data-path-to-node="25,1,0"><b>收件设置里看不到邮箱</b>?</p><ul data-path-to-node="25,1,1"><li><p data-path-to-node="25,1,1,0,0">请确保 <code>admin/script.js</code> 中的 <code>API_BASE</code> 地址配置正确，且该地址能被你的网络访问。</p></li><li><p data-path-to-node="25,1,1,1,0">确保邮箱状态是“启用”的。</p></li></ul></li></ul><h2 data-path-to-node="26">⚠️ 免责声明</h2><p data-path-to-node="27">本项目仅用于学习和个人管理用途。请勿用于发送垃圾邮件或违反 Google 服务条款的行为。使用者需自行承担数据安全和账号风险。</p></div>
